<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.joinwe.carcloud.mapper.CompanyExpandMapper">
  <resultMap id="BaseResultMap" type="com.joinwe.carcloud.dto.CompanyMessageDTO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri May 15 15:08:53 CST 2020.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="bussinesstypeid" jdbcType="VARCHAR" property="bussinesstypeid" />
    <result column="bussinesstypename" jdbcType="VARCHAR" property="bussinesstypename" />
    <result column="cover" jdbcType="VARCHAR" property="cover" />
    <result column="service_time" jdbcType="VARCHAR" property="serviceTime" />
    <result column="tel" jdbcType="VARCHAR" property="tel" />
    <result column="province" jdbcType="VARCHAR" property="province" />
    <result column="city" jdbcType="VARCHAR" property="city" />
    <result column="district" jdbcType="VARCHAR" property="district" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="longitude" jdbcType="DECIMAL" property="longitude" />
    <result column="latitude" jdbcType="DECIMAL" property="latitude" />
    <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate" />
    <result column="creatorid" jdbcType="BIGINT" property="creatorid" />
    <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified" />
    <result column="editorid" jdbcType="BIGINT" property="editorid" />
    <result column="is_deleted" jdbcType="BIT" property="isDeleted" />
    <result column="is_locked" jdbcType="BIT" property="isLocked" />
    <result column="version" jdbcType="BIGINT" property="version" />
    <result column="distance" property="distance"></result>
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.joinwe.carcloud.model.CompanyWithBLOBs">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri May 15 15:08:53 CST 2020.
    -->
    <result column="picturelist" jdbcType="LONGVARCHAR" property="picturelist" />
    <result column="service" jdbcType="LONGVARCHAR" property="service" />
    <result column="description" jdbcType="LONGVARCHAR" property="description" />
  </resultMap>

  <select id="selectByLocationWithPage" parameterType="com.joinwe.carcloud.dto.CompanyQueryDTO" resultMap="BaseResultMap">
    select *,
    ROUND(
    ACOS((SIN(#{latitude} * 3.1415) / 180) * SIN((latitude * 3.1415) / 180) + COS((#{longitude} * 3.1415) / 180) * COS((latitude * 3.1415) / 180) * COS((#{longitude} * 3.1415) / 180 - (longitude * 3.1415) / 180)) * 6371
    ) as distance
    from company
    order by distance asc limit #{indexPageNum},#{size}
  </select>
  <select id="selectByLocationWithBussinessTypeId" parameterType="com.joinwe.carcloud.dto.CompanyQueryDTO" resultMap="BaseResultMap">
    select *
    from company
    where bussinesstypeid regexp #{bussinessTypeId}
  </select>
  <select id="selectCompanyByNameOrTel" parameterType="com.joinwe.carcloud.dto.CompanyQueryDTO" resultMap="BaseResultMap">
    select *
    from company
    where tel regexp #{tel}
    or name regexp #{name}
  </select>

<!--  select * from users_location-->
<!--  where-->
<!--  latitude > '.$lat.'-1-->
<!--  and latitude < '.$lat.'+1-->
<!--  and longitude > '.$lon.'-1-->
<!--  and longitude < '.$lon.'+1-->
<!--  order by-->
<!--  ACOS(SIN(('.$lat.' * 3.1415) / 180 ) *SIN((latitude * 3.1415) / 180 ) +COS(('.$lat.' * 3.1415) / 180 ) * COS((latitude * 3.1415) / 180 ) *COS(('.$lon.'* 3.1415) / 180 - (longitude * 3.1415) / 180 ) )-->
<!--  * 6380-->
<!--  asc limit 10';-->
<!--  where-->
<!--  latitude &gt; #{latitude} - 1-->
<!--  and-->
<!--  latitude &lt; #{latitude} + 1-->
<!--  and-->
<!--  longitude &gt; #{longitude} - 1-->
<!--  and-->
<!--  longitude &lt; #{longitude} - 1-->
</mapper>